(window.webpackJsonp=window.webpackJsonp||[]).push([[297],{597:function(s,t,a){"use strict";a.r(t);var n=a(12),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"json-web-token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#json-web-token"}},[s._v("#")]),s._v(" JSON Web Token")]),s._v(" "),a("h2",{attrs:{id:"定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定义"}},[s._v("#")]),s._v(" 定义")]),s._v(" "),a("p",[s._v("其实就是一个token，由3部分组成："),a("code",[s._v("header.payload.sign")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"header部分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#header部分"}},[s._v("#")]),s._v(" header部分")]),s._v(" "),a("p",[s._v("header本身是一个json对象：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"alg"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hs256"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 加密算法")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"typ"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"JWT"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 签名类型：就是jwt")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("将这个json对象用base64url算法编码为字符串，放入jwt中。")]),s._v(" "),a("h3",{attrs:{id:"payload部分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#payload部分"}},[s._v("#")]),s._v(" payload部分")]),s._v(" "),a("p",[s._v("同样是json对象，可以用于保存不敏感的数据。例如：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"userName"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dongyuanxin"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("除此之外，这个JSON对象中还有其他JWT规定的字段。")]),s._v(" "),a("p",[s._v("和header部分一样，用base64url算法编码为字符串，放入jwt中。")]),s._v(" "),a("h3",{attrs:{id:"sign部分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sign部分"}},[s._v("#")]),s._v(" sign部分")]),s._v(" "),a("p",[s._v("将header部分和payload部分进行加密所得。伪代码如下：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" data "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" base64url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("encode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("header"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" base64url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("encode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("payload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" sign "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hs256")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 得到签名")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("代码中出现的secret是加密所需的密钥，存放在服务端，不能泄漏。工程上一般通过配置中心下发。")]),s._v(" "),a("h2",{attrs:{id:"场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#场景"}},[s._v("#")]),s._v(" 场景")]),s._v(" "),a("p",[s._v("JWT 用于分布式用户身份认证。因为服务器是无状态的，所以非常方便扩展。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/007S8ZIlgy1giyp7nr9ujj30m80fata9.jpg",alt:""}})]),s._v(" "),a("p",[s._v("上图是交互流程：")]),s._v(" "),a("ul",[a("li",[s._v("用户携带user和pwd登录")]),s._v(" "),a("li",[s._v("登录成功后，服务端签发JWT")]),s._v(" "),a("li",[s._v("之后用户每次请求都携带JWT（通过"),a("code",[s._v("headers")]),s._v("字段）")]),s._v(" "),a("li",[s._v("服务端对前端传来的JWT进行校验")])]),s._v(" "),a("p",[s._v("校验逻辑：")]),s._v(" "),a("ul",[a("li",[s._v("解出header、payload和sign")]),s._v(" "),a("li",[s._v("将header和payload加密，将加密结果与sign比较")])]),s._v(" "),a("h2",{attrs:{id:"参考链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.tomczhen.com/2017/05/25/5-easy-steps-to-understanding-json-web-tokens-jwt/",target:"_blank",rel:"noopener noreferrer"}},[s._v("五个步骤轻松弄懂 JSON Web Token（JWT）"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("JSON Web Token 入门教程"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);