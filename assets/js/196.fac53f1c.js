(window.webpackJsonp=window.webpackJsonp||[]).push([[196],{759:function(t,s,n){"use strict";n.r(s);var a=n(12),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"认识微服务架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#认识微服务架构"}},[t._v("#")]),t._v(" 认识微服务架构")]),t._v(" "),n("p",[t._v("定义：微内核架构（Microkernel Architecture），也被称为插件化架构（Plug-in Architecture），是一种面向功能进行拆分的可扩展性架构，通常用于实现基于产品的应用。")]),t._v(" "),n("p",[t._v("微服务架构内部包括核心系统和插件模块：")]),t._v(" "),n("ul",[n("li",[t._v("核心系统：负责与业务功能无关的通用功能，例如插件通信、插件管理等")]),t._v(" "),n("li",[t._v("插件系统：负责某个具体业务功能，例如图像检测、短信登录等")])]),t._v(" "),n("p",[t._v("核心系统比较稳定，改动低；插件系统改动频繁，能够快速扩展。")]),t._v(" "),n("h2",{attrs:{id:"核心系统设计关键"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#核心系统设计关键"}},[t._v("#")]),t._v(" 核心系统设计关键")]),t._v(" "),n("p",[t._v("在"),n("a",{attrs:{href:"https://juejin.im/post/5cbdbeb95188250a8c22abb0",target:"_blank",rel:"noopener noreferrer"}},[t._v("《微内核架构》"),n("OutboundLink")],1),t._v("中提到，核心系统的设计关键主要体现在“处理插件”上：")]),t._v(" "),n("ul",[n("li",[t._v("插件管理：注册插件的 api、加载插件的时机等")]),t._v(" "),n("li",[t._v("插件连接：插件接入核心系统的方式，能够调用核心系统的一些 api")]),t._v(" "),n("li",[t._v("插件通信：插件间相互调用")])]),t._v(" "),n("h2",{attrs:{id:"实战：tcb-admin-node"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实战：tcb-admin-node"}},[t._v("#")]),t._v(" 实战：tcb-admin-node")]),t._v(" "),n("p",[t._v("上面说了这么多，还是配合代码才能更好理解这种设计的好处。以 tcb-admin-node.js 为例，它不完全是基于微内核的思路进行设计的，但是在扩展能力这块的设计，和微内核思想有着异曲同工之妙。")]),t._v(" "),n("p",[t._v("打开项目根目录下的"),n("code",[t._v("index.js")]),t._v("文件，可以看到挂在 Tcb 原型链上的 registerExtension 和 invokeExtension")]),t._v(" "),n("p",[t._v("方法，如下图所示：")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://tva1.sinaimg.cn/large/007S8ZIlly1gegkgqy1tbj314t0u013u.jpg",alt:""}})]),t._v(" "),n("p",[t._v("registerExtension 负责注册插件。invokeExtension 负责按照名称调用插件，并且传入 Tcb 对象。")]),t._v(" "),n("p",[t._v("根据"),n("a",{attrs:{href:"https://docs.cloudbase.net/extension/abilities/image-examination.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("tcb 扩展能力文档"),n("OutboundLink")],1),t._v("，可以看到，插件的注册是在"),n("code",[t._v("init")]),t._v("之后：")]),t._v(" "),n("div",{staticClass:"language-JavaScript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" extCi "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@cloudbase/extension-ci"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ntcb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    env"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"您的环境ID"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ntcb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerExtension")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("extCi"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])]),n("p",[t._v("对于扩展@cloudbase/extension-ci 来说，它需要暴露 name 属性，以及 invoke 方法。从 npm 下载的源码中可以看到：")]),t._v(" "),n("div",{staticClass:"language-JavaScript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invoke")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("opts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tcb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ... 具体的业务逻辑")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nexports"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CloudInfinite"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nexports"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("invoke "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" invoke"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])]),n("p",[t._v("name 属性作为拓展的标识，在核心系统调用时需要用到；invoke 函数封装具体的业务逻辑，tcb 参数由核心系统注入，可以调用其上方法，例如云函数、云数据库读写、云存储等等。")]),t._v(" "),n("p",[t._v("看到这里，应该可以体会到微内核+插件化的设计的优点了。在 js 中，配合 es6 module，还能起到“源码瘦身、按需加载”的作用。")])])}),[],!1,null,null,null);s.default=e.exports}}]);