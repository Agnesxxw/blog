(window.webpackJsonp=window.webpackJsonp||[]).push([[189],{748:function(t,v,a){"use strict";a.r(v);var _=a(12),s=Object(_.a)({},(function(){var t=this,v=t.$createElement,a=t._self._c||v;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("存储高可用通过数据复制，来实现数据冗余，进而实现高可用。")]),t._v(" "),a("p",[t._v("难点在于明确节点的职责、数据复制策略、如何处理意外（复制延迟、中断）。")]),t._v(" "),a("h2",{attrs:{id:"双机架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#双机架构"}},[t._v("#")]),t._v(" 双机架构")]),t._v(" "),a("h3",{attrs:{id:"主备复制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主备复制"}},[t._v("#")]),t._v(" 主备复制")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/007S8ZIlgy1gh6pb3yrr1j30v60m1ab7.jpg",alt:""}})]),t._v(" "),a("p",[t._v("备机不提供读写服务。当主机挂掉后，人工升级备机为主机。")]),t._v(" "),a("p",[a("strong",[t._v("一般用于内部系统，例如学生管理、员工管理等，数据变更频率低，可以人工方法补全。")])]),t._v(" "),a("h3",{attrs:{id:"主从复制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主从复制"}},[t._v("#")]),t._v(" 主从复制")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/007S8ZIlgy1gh6pbcgl4xj30v60m1gmo.jpg",alt:""}})]),t._v(" "),a("p",[t._v("从机对外提供读服务。客户端需要感知主从关系，一些业务数据需在代码中到从机上读取，以分散主机读写压力。")]),t._v(" "),a("p",[a("strong",[t._v("一般用于读多写少的场景，例如 BBS、新网网站等。")])]),t._v(" "),a("h3",{attrs:{id:"双机切换"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#双机切换"}},[t._v("#")]),t._v(" 双机切换")]),t._v(" "),a("p",[t._v("主备和主从的共性问题：主机故障后，无法自动切换，无法保证读写业务正常进行。这时需要用到双机切换（以主备为例，主从相似）。")]),t._v(" "),a("p",[t._v("思考点是：切换时机、切换策略、自动程度。")]),t._v(" "),a("p",[a("strong",[t._v("1、互连式")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/007S8ZIlgy1gh6pbk2mskj30bd0bv3z0.jpg",alt:""}})]),t._v(" "),a("p",[t._v("在主备的基础上，主和备之间多了一条“状态传递”通道。备机获取主机的状态，当主机有问题时，备机升级为主机。")]),t._v(" "),a("p",[a("strong",[t._v("2、中介式")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/007S8ZIlgy1gh6pbq0q4lj30ch0cw0ta.jpg",alt:""}})]),t._v(" "),a("p",[t._v("和“互连式”相比，主备不直接相连，通过中介来传递状态信息。")]),t._v(" "),a("p",[a("strong",[t._v("3、模拟式")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/007S8ZIlgy1gh6pc45wesj30ee0ctgm9.jpg",alt:""}})]),t._v(" "),a("p",[t._v("备机模拟客户端，像主机起读写请求，根据请求判断主机状态。")]),t._v(" "),a("h3",{attrs:{id:"主主复制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主主复制"}},[t._v("#")]),t._v(" 主主复制")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/007S8ZIlgy1gh6pccef6rj309e0aa3yv.jpg",alt:""}})]),t._v(" "),a("p",[t._v("两台均为主机，都对外提供读写服务，互相复制数据给对方。")]),t._v(" "),a("p",[t._v("主主复制限制比较多，要求“数据可以双向复制”。以下场景不行：")]),t._v(" "),a("ul",[a("li",[t._v("自增的数据 ID。例如在 A 注册用户，ID 为 99；在 B 注册了用户，ID 也为 99。同步数据时会发生冲突。")]),t._v(" "),a("li",[t._v("库存。例如在 A 上减少到 99，在 B 上减少到 98。")])]),t._v(" "),a("p",[t._v("主要用于：临时性、可丢失、可复制的数据场景。例如 session、用户行为上报、日志等。")]),t._v(" "),a("h2",{attrs:{id:"数据集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据集群"}},[t._v("#")]),t._v(" 数据集群")]),t._v(" "),a("p",[a("strong",[t._v("双机架构和数据集群的关系")])]),t._v(" "),a("p",[t._v("双机架构只考虑特定数量的主机，假设前提是主机本身的能力够用。\n但是单机本身是有瓶颈的。突破单机瓶颈，就要用到数据集群了。")]),t._v(" "),a("h3",{attrs:{id:"数据集中集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据集中集群"}},[t._v("#")]),t._v(" 数据集中集群")]),t._v(" "),a("p",[t._v("类似主备、主从，是 1 主多备，或者 1 主多从。")]),t._v(" "),a("p",[t._v("需要考虑的问题：")]),t._v(" "),a("ul",[a("li",[t._v("复制策略：多个备机，复制压力大；备机可能数据不相同，需要校验一致性和修正。")]),t._v(" "),a("li",[t._v("主机状态：多台备机对主机进行状态检测，需要考量结果不同时如何判断。")]),t._v(" "),a("li",[t._v("主机故障：如何选取新的主机")])]),t._v(" "),a("p",[t._v("常见场景：数据量不大、数据机器不多。例如 "),a("code",[t._v("ZooKeeper")]),t._v(" 集群（5 台左右）")]),t._v(" "),a("h3",{attrs:{id:"数据分散集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据分散集群"}},[t._v("#")]),t._v(" 数据分散集群")]),t._v(" "),a("p",[t._v("类似于主主，由多个服务器组成，每台都会存储部分数据。")]),t._v(" "),a("p",[t._v("需要考虑的问题：")]),t._v(" "),a("ul",[a("li",[t._v("数据分布均衡")]),t._v(" "),a("li",[t._v("服务容错：故障时，分配给故障服务器的数据要分配给其他服务器")]),t._v(" "),a("li",[t._v("可伸缩")])]),t._v(" "),a("p",[t._v("常见场景：数据庞大、机器庞大。例如 "),a("code",[t._v("Hadoop")]),t._v(" 集群、 "),a("code",[t._v("HBase")]),t._v(" 集群（百台起步）。")]),t._v(" "),a("p",[a("strong",[t._v("集中集群和分散集群中的“主机”")])]),t._v(" "),a("p",[t._v("集中集群：承担读写业务\n分散集群：负责执行数据分配算法，类似于管理员。")]),t._v(" "),a("h2",{attrs:{id:"数据分区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据分区"}},[t._v("#")]),t._v(" 数据分区")]),t._v(" "),a("p",[a("strong",[t._v("数据分区的作用")])]),t._v(" "),a("p",[t._v("所站角度更高，主要应对大型灾难和事故。\n一个系统有多个分区，每个分区下可以有自己的集群。")]),t._v(" "),a("h3",{attrs:{id:"集中式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集中式"}},[t._v("#")]),t._v(" 集中式")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/007S8ZIlgy1gh6pct7uddj30aj065glw.jpg",alt:""}})]),t._v(" "),a("p",[t._v("集中式备份指存在一个总的备份中心，所有的分区都将数据备份到备份中心。")]),t._v(" "),a("p",[t._v("设计简单，扩展容易，但是独立备份成本性能要求高，成本高。")]),t._v(" "),a("h3",{attrs:{id:"互备式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#互备式"}},[t._v("#")]),t._v(" 互备式")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/007S8ZIlgy1gh6pd2de9lj30ak04o74h.jpg",alt:""}})]),t._v(" "),a("p",[t._v("互备式备份指每个分区备份另外一个分区的数据。")]),t._v(" "),a("p",[t._v("设计复杂，扩展麻烦（需要修改指向），但是成本低，利用已有设备。")]),t._v(" "),a("h3",{attrs:{id:"独立式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#独立式"}},[t._v("#")]),t._v(" 独立式")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/007S8ZIlgy1gh6pdbb9umj30c4052jrp.jpg",alt:""}})]),t._v(" "),a("p",[t._v("独立式备份指每个分区自己有独立的备份中心。")]),t._v(" "),a("p",[t._v("设计简单，扩展容易，比集中式成本更高。")])])}),[],!1,null,null,null);v.default=s.exports}}]);