(window.webpackJsonp=window.webpackJsonp||[]).push([[188],{747:function(t,a,r){"use strict";r.r(a);var e=r(12),s=Object(e.a)({},(function(){var t=this,a=t.$createElement,r=t._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("p",[t._v("相较于异地多活、高可用存储、高可用计算这些高大上的东东，接口故障平时出现的概率更高。例如某个接口导致了慢查询，返回时间过长；某个接口依赖第三方接口，结果第三方接口挂掉了，拖慢整个服务。")]),t._v(" "),r("p",[t._v("针对接口故障，有以下处理方法：")]),t._v(" "),r("h2",{attrs:{id:"降级"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#降级"}},[t._v("#")]),t._v(" 降级")]),t._v(" "),r("p",[r("strong",[t._v("其思想是保证核心业务接口正常")]),t._v("，关闭其他接口。例如对于论坛，当访问量突增，保证读帖接口正常，但是发帖接口性能可以适当降低。")]),t._v(" "),r("p",[t._v("降级的目的是处理系统自身故障。")]),t._v(" "),r("h2",{attrs:{id:"熔断"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#熔断"}},[t._v("#")]),t._v(" 熔断")]),t._v(" "),r("p",[t._v("熔断的目的是应对依赖的外部系统的故障。")]),t._v(" "),r("p",[t._v("例如 A 服务接口依赖第三方的 B 服务接口，当 B 服务接口慢或者挂掉，A 服务对外的接口会被拖垮。此时需要进行熔断。")]),t._v(" "),r("h2",{attrs:{id:"限流"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#限流"}},[t._v("#")]),t._v(" 限流")]),t._v(" "),r("p",[t._v("降级是从系统功能优先级的角度考虑如何应对故障，而"),r("strong",[t._v("限流则是从用户访问压力的角度来考虑如何应对故障")]),t._v("。")]),t._v(" "),r("p",[t._v("对外可以基于请求限流，例如 QPS 上限为 10000；对内可以基于资源限流，例如系统 CPU、内存占用率、连接数等数据。")]),t._v(" "),r("h2",{attrs:{id:"排队"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#排队"}},[t._v("#")]),t._v(" 排队")]),t._v(" "),r("p",[t._v("类似限流，但是限流是直接拒绝用户，排队是让用户等待一段时间。场景主要有：12306 抢票、电商秒杀等等。")]),t._v(" "),r("h2",{attrs:{id:"思考题"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#思考题"}},[t._v("#")]),t._v(" 思考题")]),t._v(" "),r("blockquote",[r("p",[t._v("如果你来设计一个整点限量秒杀系统，包括登录、抢购、支付（依赖支付宝）等功能，你会如何设计接口级的故障应对手段?")])]),t._v(" "),r("p",[t._v("1、业务上准备降级策略，保证登录可用，注册等功能可以降级\n2、秒杀请求做排队处理，防止超卖\n3、库存和商品数据属于“缓存热点”，活动开始前可以载入缓存\n4、三方支付依赖系统，设置一个平均时长，超出时间，引导用户重新支付")]),t._v(" "),r("h2",{attrs:{id:"参考链接"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[t._v("#")]),t._v(" 参考链接")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://time.geekbang.org/column/article/6354",target:"_blank",rel:"noopener noreferrer"}},[t._v("极客时间：从 0 学架构"),r("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=s.exports}}]);