(window.webpackJsonp=window.webpackJsonp||[]).push([[178],{732:function(r,e,a){"use strict";a.r(e);var t=a(12),s=Object(t.a)({},(function(){var r=this,e=r.$createElement,a=r._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":r.$parent.slotKey}},[a("h2",{attrs:{id:"x-powered-by"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#x-powered-by"}},[r._v("#")]),r._v(" X-Powered-By")]),r._v(" "),a("p",[a("code",[r._v("X-")]),r._v("开头的自定义字段。由语言解析器或者应用程序框架输出的，例如 PHP 的输出是：X-Powered-By: PHP/5.2.1")]),r._v(" "),a("p",[r._v("它可以告诉开发者后端使用的是什么框架/语言，所以有安全风险。对于自带此字段的框架/语言，需要手动去掉。")]),r._v(" "),a("p",[r._v("在"),a("code",[r._v("express")]),r._v(" 或者 "),a("code",[r._v("nestjs")]),r._v("中，可以使用：")]),r._v(" "),a("div",{staticClass:"language-JavaScript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[r._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[r._v("disable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[r._v("'x-powered-by'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[r._v(";")]),r._v("\n")])]),r._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[r._v("1")]),a("br")])]),a("h2",{attrs:{id:"x-forwarded-for"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#x-forwarded-for"}},[r._v("#")]),r._v(" X-Forwarded-For")]),r._v(" "),a("p",[a("code",[r._v("X-")]),r._v("开头的自定义字段。用来识别通过代理或者负载均衡连接到服务端的真实 IP 地址路径。")]),r._v(" "),a("p",[r._v("例如对于 "),a("code",[r._v("X-Forwarded-For: client1, proxy1, proxy2")]),r._v(" 来说，请求链路如下：")]),r._v(" "),a("ul",[a("li",[r._v("从 client1 发出，抵达 proxy1")]),r._v(" "),a("li",[r._v("proxy1 将 client1 放入 X-Forwarded-For，请求转发到 proxy2")]),r._v(" "),a("li",[r._v("proxy2 将 proxy1 放入 X-Forwarded-For，请求转发到服务端")]),r._v(" "),a("li",[r._v("服务端将 proxy2 放入 X-Forwarded-For，请求不再被转发，返回数据")])]),r._v(" "),a("p",[a("strong",[r._v("可以看到，代理服务器每成功收到一个请求，就把请求来源 IP 地址添加到右边")]),r._v("。")]),r._v(" "),a("h2",{attrs:{id:"x-real-ip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#x-real-ip"}},[r._v("#")]),r._v(" X-Real-IP")]),r._v(" "),a("p",[a("code",[r._v("X-")]),r._v("开头的自定义字段，不属于任何任何标准。用来表示与 HTTP 代理产生 TCP 连接的设备 IP。")]),r._v(" "),a("p",[a("strong",[r._v("安全问题")])]),r._v(" "),a("p",[r._v("攻击者可以通过手动构造 "),a("code",[r._v("X-Real-IP")]),r._v(" 和 "),a("code",[r._v("X-Forwarded-For")]),r._v(" 来伪造真实的源 IP。")]),r._v(" "),a("p",[r._v("解决方法：前面使用 Nginx 代理。")]),r._v(" "),a("p",[r._v("原理：Nginx 会从 TCP 链接中获取真正的 IP 信息，将其追加到"),a("code",[r._v("X-Forwarded-For")]),r._v("最右侧，覆盖客户端伪造的"),a("code",[r._v("X-Real-IP")]),r._v(" 。")]),r._v(" "),a("div",{staticClass:"language-纯文本 line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[r._v("location / {\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n}\n")])]),r._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[r._v("1")]),a("br"),a("span",{staticClass:"line-number"},[r._v("2")]),a("br"),a("span",{staticClass:"line-number"},[r._v("3")]),a("br"),a("span",{staticClass:"line-number"},[r._v("4")]),a("br")])]),a("h2",{attrs:{id:"参考链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[r._v("#")]),r._v(" 参考链接")]),r._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://zh.wikipedia.org/wiki/X-Forwarded-For",target:"_blank",rel:"noopener noreferrer"}},[r._v("Wiki: X-Forwarded-For"),a("OutboundLink")],1)]),r._v(" "),a("li",[a("a",{attrs:{href:"https://imququ.com/post/x-forwarded-for-header-in-http.html",target:"_blank",rel:"noopener noreferrer"}},[r._v("HTTP 请求头中的 X-Forwarded-For"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=s.exports}}]);