<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>引言 | 心谭博客</title>
    <meta name="generator" content="VuePress 1.5.0">
    <script type="text/javascript" src="/scripts/baidu-analytics.js" async=""></script>
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="专注前端与算法的博客">
    <link rel="preload" href="/assets/css/0.styles.ba668900.css" as="style"><link rel="preload" href="/assets/js/app.f478fbae.js" as="script"><link rel="preload" href="/assets/js/2.698e7189.js" as="script"><link rel="preload" href="/assets/js/3.9966209a.js" as="script"><link rel="preload" href="/assets/js/235.5560e5d3.js" as="script"><link rel="preload" href="/assets/js/5.51d45416.js" as="script"><link rel="prefetch" href="/assets/js/10.125e849b.js"><link rel="prefetch" href="/assets/js/100.ecf0c9e0.js"><link rel="prefetch" href="/assets/js/101.488273e2.js"><link rel="prefetch" href="/assets/js/102.ce935938.js"><link rel="prefetch" href="/assets/js/103.0d50843d.js"><link rel="prefetch" href="/assets/js/104.dec558ea.js"><link rel="prefetch" href="/assets/js/105.aa96c243.js"><link rel="prefetch" href="/assets/js/106.e557f585.js"><link rel="prefetch" href="/assets/js/107.5418b2be.js"><link rel="prefetch" href="/assets/js/108.378422bb.js"><link rel="prefetch" href="/assets/js/109.f6bb72d2.js"><link rel="prefetch" href="/assets/js/11.1ccc6888.js"><link rel="prefetch" href="/assets/js/110.41d9adbd.js"><link rel="prefetch" href="/assets/js/111.29a1ddea.js"><link rel="prefetch" href="/assets/js/112.a7e5ec0e.js"><link rel="prefetch" href="/assets/js/113.4aecb2cb.js"><link rel="prefetch" href="/assets/js/114.47b56f5a.js"><link rel="prefetch" href="/assets/js/115.a38e6878.js"><link rel="prefetch" href="/assets/js/116.5e2808f5.js"><link rel="prefetch" href="/assets/js/117.de44b7f2.js"><link rel="prefetch" href="/assets/js/118.48fc4675.js"><link rel="prefetch" href="/assets/js/119.cac5adb8.js"><link rel="prefetch" href="/assets/js/12.2b8a914b.js"><link rel="prefetch" href="/assets/js/120.b5073751.js"><link rel="prefetch" href="/assets/js/121.76d9c9b9.js"><link rel="prefetch" href="/assets/js/122.bbdd442e.js"><link rel="prefetch" href="/assets/js/123.90edd15a.js"><link rel="prefetch" href="/assets/js/124.1a22938f.js"><link rel="prefetch" href="/assets/js/125.3a78e7c0.js"><link rel="prefetch" href="/assets/js/126.2170b737.js"><link rel="prefetch" href="/assets/js/127.a50d69a5.js"><link rel="prefetch" href="/assets/js/128.3aa5178c.js"><link rel="prefetch" href="/assets/js/129.52219775.js"><link rel="prefetch" href="/assets/js/13.146af216.js"><link rel="prefetch" href="/assets/js/130.a3fe595d.js"><link rel="prefetch" href="/assets/js/131.ffb980bb.js"><link rel="prefetch" href="/assets/js/132.30fd3f2b.js"><link rel="prefetch" href="/assets/js/133.3d494ec7.js"><link rel="prefetch" href="/assets/js/134.d5bef0ed.js"><link rel="prefetch" href="/assets/js/135.96e3dedb.js"><link rel="prefetch" href="/assets/js/136.c1ba8082.js"><link rel="prefetch" href="/assets/js/137.1d998785.js"><link rel="prefetch" href="/assets/js/138.eff08193.js"><link rel="prefetch" href="/assets/js/139.a74ff62d.js"><link rel="prefetch" href="/assets/js/14.d1605b0a.js"><link rel="prefetch" href="/assets/js/140.42d7cc5f.js"><link rel="prefetch" href="/assets/js/141.0be86f18.js"><link rel="prefetch" href="/assets/js/142.4cb518de.js"><link rel="prefetch" href="/assets/js/143.8e21f1f6.js"><link rel="prefetch" href="/assets/js/144.dcbe5600.js"><link rel="prefetch" href="/assets/js/145.33f3029c.js"><link rel="prefetch" href="/assets/js/146.37a87f52.js"><link rel="prefetch" href="/assets/js/147.3abbfff9.js"><link rel="prefetch" href="/assets/js/148.f73b5bb7.js"><link rel="prefetch" href="/assets/js/149.88bd82ad.js"><link rel="prefetch" href="/assets/js/15.ba36a578.js"><link rel="prefetch" href="/assets/js/150.7d145106.js"><link rel="prefetch" href="/assets/js/151.9d9f4771.js"><link rel="prefetch" href="/assets/js/152.9ce51fb1.js"><link rel="prefetch" href="/assets/js/153.29af3f5c.js"><link rel="prefetch" href="/assets/js/154.9e5e6f08.js"><link rel="prefetch" href="/assets/js/155.8e63a53b.js"><link rel="prefetch" href="/assets/js/156.d986d407.js"><link rel="prefetch" href="/assets/js/157.f56e37c7.js"><link rel="prefetch" href="/assets/js/158.1868b35b.js"><link rel="prefetch" href="/assets/js/159.9d6b377f.js"><link rel="prefetch" href="/assets/js/16.6c490e98.js"><link rel="prefetch" href="/assets/js/160.4079d370.js"><link rel="prefetch" href="/assets/js/161.3d1e0b85.js"><link rel="prefetch" href="/assets/js/162.e79b0472.js"><link rel="prefetch" href="/assets/js/163.ab16f20c.js"><link rel="prefetch" href="/assets/js/164.fae90350.js"><link rel="prefetch" href="/assets/js/165.1d7ad8e2.js"><link rel="prefetch" href="/assets/js/166.530126dd.js"><link rel="prefetch" href="/assets/js/167.3b072cf3.js"><link rel="prefetch" href="/assets/js/168.45fe3fa9.js"><link rel="prefetch" href="/assets/js/169.0b80f872.js"><link rel="prefetch" href="/assets/js/17.05eaa017.js"><link rel="prefetch" href="/assets/js/170.4f528b9c.js"><link rel="prefetch" href="/assets/js/171.a0aeeb5c.js"><link rel="prefetch" href="/assets/js/172.8f71a05d.js"><link rel="prefetch" href="/assets/js/173.e00e2e7b.js"><link rel="prefetch" href="/assets/js/174.52418ba2.js"><link rel="prefetch" href="/assets/js/175.030eb300.js"><link rel="prefetch" href="/assets/js/176.ca5b7419.js"><link rel="prefetch" href="/assets/js/177.c6d623d7.js"><link rel="prefetch" href="/assets/js/178.3f64d6fb.js"><link rel="prefetch" href="/assets/js/179.7dd709e7.js"><link rel="prefetch" href="/assets/js/18.1b658bb9.js"><link rel="prefetch" href="/assets/js/180.a5eb2128.js"><link rel="prefetch" href="/assets/js/181.de8b20cd.js"><link rel="prefetch" href="/assets/js/182.eaec82e3.js"><link rel="prefetch" href="/assets/js/183.27e2c119.js"><link rel="prefetch" href="/assets/js/184.d8edd40c.js"><link rel="prefetch" href="/assets/js/185.9f884e8c.js"><link rel="prefetch" href="/assets/js/186.aeb047bc.js"><link rel="prefetch" href="/assets/js/187.dd9473ed.js"><link rel="prefetch" href="/assets/js/188.ae03c25f.js"><link rel="prefetch" href="/assets/js/189.b1f6dbcd.js"><link rel="prefetch" href="/assets/js/19.26b9e4d9.js"><link rel="prefetch" href="/assets/js/190.7fc3b722.js"><link rel="prefetch" href="/assets/js/191.8c41b4b4.js"><link rel="prefetch" href="/assets/js/192.173942ef.js"><link rel="prefetch" href="/assets/js/193.0ebe20eb.js"><link rel="prefetch" href="/assets/js/194.ff6b30bb.js"><link rel="prefetch" href="/assets/js/195.2b97d7a8.js"><link rel="prefetch" href="/assets/js/196.fac53f1c.js"><link rel="prefetch" href="/assets/js/197.64a59f4d.js"><link rel="prefetch" href="/assets/js/198.95c9e0a6.js"><link rel="prefetch" href="/assets/js/199.6b83791e.js"><link rel="prefetch" href="/assets/js/20.388d03bf.js"><link rel="prefetch" href="/assets/js/200.3fbec35a.js"><link rel="prefetch" href="/assets/js/201.de42ae13.js"><link rel="prefetch" href="/assets/js/202.99efdd31.js"><link rel="prefetch" href="/assets/js/203.3ecda53b.js"><link rel="prefetch" href="/assets/js/204.6cdb0b3c.js"><link rel="prefetch" href="/assets/js/205.13ef96fa.js"><link rel="prefetch" href="/assets/js/206.782ead0f.js"><link rel="prefetch" href="/assets/js/207.d3984ab7.js"><link rel="prefetch" href="/assets/js/208.e86cc1ea.js"><link rel="prefetch" href="/assets/js/209.a05db817.js"><link rel="prefetch" href="/assets/js/21.ea7ddc97.js"><link rel="prefetch" href="/assets/js/210.4bfaffa7.js"><link rel="prefetch" href="/assets/js/211.7cb6e289.js"><link rel="prefetch" href="/assets/js/212.0c0ece64.js"><link rel="prefetch" href="/assets/js/213.3e74ea57.js"><link rel="prefetch" href="/assets/js/214.96abae91.js"><link rel="prefetch" href="/assets/js/215.8c9c781d.js"><link rel="prefetch" href="/assets/js/216.1242c16d.js"><link rel="prefetch" href="/assets/js/217.baf611b7.js"><link rel="prefetch" href="/assets/js/218.9207a585.js"><link rel="prefetch" href="/assets/js/219.f675ac7a.js"><link rel="prefetch" href="/assets/js/22.48c1844d.js"><link rel="prefetch" href="/assets/js/220.03861fcd.js"><link rel="prefetch" href="/assets/js/221.b5b098cd.js"><link rel="prefetch" href="/assets/js/222.039195d2.js"><link rel="prefetch" href="/assets/js/223.0dbda1f5.js"><link rel="prefetch" href="/assets/js/224.d3c6f57b.js"><link rel="prefetch" href="/assets/js/225.8dcf755e.js"><link rel="prefetch" href="/assets/js/226.86e7ed62.js"><link rel="prefetch" href="/assets/js/227.920ea7a7.js"><link rel="prefetch" href="/assets/js/228.b27cbe8d.js"><link rel="prefetch" href="/assets/js/229.a56affd6.js"><link rel="prefetch" href="/assets/js/23.af843b43.js"><link rel="prefetch" href="/assets/js/230.90ecc14e.js"><link rel="prefetch" href="/assets/js/231.a50ba866.js"><link rel="prefetch" href="/assets/js/232.6826940c.js"><link rel="prefetch" href="/assets/js/233.4b50e8a8.js"><link rel="prefetch" href="/assets/js/234.992ffb94.js"><link rel="prefetch" href="/assets/js/236.282c7627.js"><link rel="prefetch" href="/assets/js/237.ee0eff29.js"><link rel="prefetch" href="/assets/js/238.06a7c830.js"><link rel="prefetch" href="/assets/js/239.2305a644.js"><link rel="prefetch" href="/assets/js/24.57d69605.js"><link rel="prefetch" href="/assets/js/240.8d7d509f.js"><link rel="prefetch" href="/assets/js/241.909f65af.js"><link rel="prefetch" href="/assets/js/242.1453db7a.js"><link rel="prefetch" href="/assets/js/243.358bb546.js"><link rel="prefetch" href="/assets/js/244.eabe3386.js"><link rel="prefetch" href="/assets/js/245.7b538c81.js"><link rel="prefetch" href="/assets/js/246.978d818b.js"><link rel="prefetch" href="/assets/js/247.1d473e2d.js"><link rel="prefetch" href="/assets/js/248.6022bb41.js"><link rel="prefetch" href="/assets/js/249.da8bc6d4.js"><link rel="prefetch" href="/assets/js/25.4e035733.js"><link rel="prefetch" href="/assets/js/250.ad443c34.js"><link rel="prefetch" href="/assets/js/251.8ec7073c.js"><link rel="prefetch" href="/assets/js/252.b8e54476.js"><link rel="prefetch" href="/assets/js/253.e88d077f.js"><link rel="prefetch" href="/assets/js/254.433a6654.js"><link rel="prefetch" href="/assets/js/255.d46248e3.js"><link rel="prefetch" href="/assets/js/256.8ca68cc4.js"><link rel="prefetch" href="/assets/js/257.e53e1425.js"><link rel="prefetch" href="/assets/js/258.5f90d970.js"><link rel="prefetch" href="/assets/js/259.3409f224.js"><link rel="prefetch" href="/assets/js/26.64a7917e.js"><link rel="prefetch" href="/assets/js/260.26197d67.js"><link rel="prefetch" href="/assets/js/261.ee93c99d.js"><link rel="prefetch" href="/assets/js/262.ec3f123e.js"><link rel="prefetch" href="/assets/js/263.4a108917.js"><link rel="prefetch" href="/assets/js/264.2450407d.js"><link rel="prefetch" href="/assets/js/265.f81c98d1.js"><link rel="prefetch" href="/assets/js/266.963dbdcb.js"><link rel="prefetch" href="/assets/js/267.45c41b8b.js"><link rel="prefetch" href="/assets/js/268.10042086.js"><link rel="prefetch" href="/assets/js/269.7b986c0f.js"><link rel="prefetch" href="/assets/js/27.c2ce77e5.js"><link rel="prefetch" href="/assets/js/270.2c7179a3.js"><link rel="prefetch" href="/assets/js/271.2a53953e.js"><link rel="prefetch" href="/assets/js/272.7f683fa7.js"><link rel="prefetch" href="/assets/js/273.97e1ffb1.js"><link rel="prefetch" href="/assets/js/274.15e56697.js"><link rel="prefetch" href="/assets/js/275.209a5337.js"><link rel="prefetch" href="/assets/js/276.15b36e13.js"><link rel="prefetch" href="/assets/js/277.30ef5862.js"><link rel="prefetch" href="/assets/js/278.944db84b.js"><link rel="prefetch" href="/assets/js/279.699674ae.js"><link rel="prefetch" href="/assets/js/28.013d42b0.js"><link rel="prefetch" href="/assets/js/280.986361cd.js"><link rel="prefetch" href="/assets/js/281.cfc3e14b.js"><link rel="prefetch" href="/assets/js/282.4d9c900f.js"><link rel="prefetch" href="/assets/js/283.830bab2e.js"><link rel="prefetch" href="/assets/js/284.1649ea94.js"><link rel="prefetch" href="/assets/js/285.8efbaa54.js"><link rel="prefetch" href="/assets/js/286.b95281f9.js"><link rel="prefetch" href="/assets/js/287.1434dc4e.js"><link rel="prefetch" href="/assets/js/288.9616ea68.js"><link rel="prefetch" href="/assets/js/289.e64f985c.js"><link rel="prefetch" href="/assets/js/29.ada84a99.js"><link rel="prefetch" href="/assets/js/290.f39fd36b.js"><link rel="prefetch" href="/assets/js/291.05d0a77c.js"><link rel="prefetch" href="/assets/js/292.2cefca4f.js"><link rel="prefetch" href="/assets/js/293.135a6682.js"><link rel="prefetch" href="/assets/js/294.d57140d2.js"><link rel="prefetch" href="/assets/js/295.f2970689.js"><link rel="prefetch" href="/assets/js/296.21acd6c4.js"><link rel="prefetch" href="/assets/js/297.71d9f7f7.js"><link rel="prefetch" href="/assets/js/298.eb488ca4.js"><link rel="prefetch" href="/assets/js/299.c91c64c9.js"><link rel="prefetch" href="/assets/js/30.d76a421c.js"><link rel="prefetch" href="/assets/js/300.e404f168.js"><link rel="prefetch" href="/assets/js/301.11a56117.js"><link rel="prefetch" href="/assets/js/302.a27fc58a.js"><link rel="prefetch" href="/assets/js/303.0ef3ae33.js"><link rel="prefetch" href="/assets/js/304.397a6915.js"><link rel="prefetch" href="/assets/js/305.8e37f27c.js"><link rel="prefetch" href="/assets/js/306.92cc7922.js"><link rel="prefetch" href="/assets/js/307.87ab2242.js"><link rel="prefetch" href="/assets/js/308.f4717d56.js"><link rel="prefetch" href="/assets/js/309.334750a4.js"><link rel="prefetch" href="/assets/js/31.16080819.js"><link rel="prefetch" href="/assets/js/310.abe10266.js"><link rel="prefetch" href="/assets/js/311.4f8695ae.js"><link rel="prefetch" href="/assets/js/312.52a3160d.js"><link rel="prefetch" href="/assets/js/313.344aff07.js"><link rel="prefetch" href="/assets/js/314.0bf4c0bb.js"><link rel="prefetch" href="/assets/js/315.4da73cad.js"><link rel="prefetch" href="/assets/js/316.2796c673.js"><link rel="prefetch" href="/assets/js/317.87e3844c.js"><link rel="prefetch" href="/assets/js/318.e7701d79.js"><link rel="prefetch" href="/assets/js/319.a3d489d6.js"><link rel="prefetch" href="/assets/js/32.1bfb0d2f.js"><link rel="prefetch" href="/assets/js/320.dc5b5d91.js"><link rel="prefetch" href="/assets/js/321.705a66ad.js"><link rel="prefetch" href="/assets/js/322.311ad61f.js"><link rel="prefetch" href="/assets/js/323.29ad7f94.js"><link rel="prefetch" href="/assets/js/324.11e9657a.js"><link rel="prefetch" href="/assets/js/325.c292ec13.js"><link rel="prefetch" href="/assets/js/326.2fadd0c5.js"><link rel="prefetch" href="/assets/js/327.ae5c22e5.js"><link rel="prefetch" href="/assets/js/328.c7f9b408.js"><link rel="prefetch" href="/assets/js/329.63c33840.js"><link rel="prefetch" href="/assets/js/33.9e4ec2aa.js"><link rel="prefetch" href="/assets/js/330.b9a9128f.js"><link rel="prefetch" href="/assets/js/331.178f0f0b.js"><link rel="prefetch" href="/assets/js/332.91dbe7d8.js"><link rel="prefetch" href="/assets/js/333.5c920372.js"><link rel="prefetch" href="/assets/js/334.d8f3bbe2.js"><link rel="prefetch" href="/assets/js/335.44d1d5a4.js"><link rel="prefetch" href="/assets/js/336.eb3286ce.js"><link rel="prefetch" href="/assets/js/337.50f44085.js"><link rel="prefetch" href="/assets/js/338.d98a7547.js"><link rel="prefetch" href="/assets/js/339.1da6f36f.js"><link rel="prefetch" href="/assets/js/34.a0daddcb.js"><link rel="prefetch" href="/assets/js/340.e729428d.js"><link rel="prefetch" href="/assets/js/341.201e2338.js"><link rel="prefetch" href="/assets/js/342.5d6fd80d.js"><link rel="prefetch" href="/assets/js/343.bf6c1a53.js"><link rel="prefetch" href="/assets/js/35.1eb4e4a0.js"><link rel="prefetch" href="/assets/js/36.f668800d.js"><link rel="prefetch" href="/assets/js/37.dbf95fc8.js"><link rel="prefetch" href="/assets/js/38.211b6e60.js"><link rel="prefetch" href="/assets/js/39.10a3442a.js"><link rel="prefetch" href="/assets/js/4.924b2ca5.js"><link rel="prefetch" href="/assets/js/40.7796b507.js"><link rel="prefetch" href="/assets/js/41.d6bd0371.js"><link rel="prefetch" href="/assets/js/42.1b393698.js"><link rel="prefetch" href="/assets/js/43.d3b71cba.js"><link rel="prefetch" href="/assets/js/44.87edd570.js"><link rel="prefetch" href="/assets/js/45.28eab6a9.js"><link rel="prefetch" href="/assets/js/46.d9f259db.js"><link rel="prefetch" href="/assets/js/47.c7525769.js"><link rel="prefetch" href="/assets/js/48.a368c70a.js"><link rel="prefetch" href="/assets/js/49.7ec12d35.js"><link rel="prefetch" href="/assets/js/50.721adef2.js"><link rel="prefetch" href="/assets/js/51.d81fa0a5.js"><link rel="prefetch" href="/assets/js/52.a12c1929.js"><link rel="prefetch" href="/assets/js/53.91181033.js"><link rel="prefetch" href="/assets/js/54.8cd29143.js"><link rel="prefetch" href="/assets/js/55.786d0609.js"><link rel="prefetch" href="/assets/js/56.f16818c1.js"><link rel="prefetch" href="/assets/js/57.ec6f9977.js"><link rel="prefetch" href="/assets/js/58.05d3bfe4.js"><link rel="prefetch" href="/assets/js/59.514e5c51.js"><link rel="prefetch" href="/assets/js/6.e699cefb.js"><link rel="prefetch" href="/assets/js/60.cd4340b7.js"><link rel="prefetch" href="/assets/js/61.92ff87b0.js"><link rel="prefetch" href="/assets/js/62.66ba8fcc.js"><link rel="prefetch" href="/assets/js/63.7e4002c5.js"><link rel="prefetch" href="/assets/js/64.e52f39b1.js"><link rel="prefetch" href="/assets/js/65.7d29999d.js"><link rel="prefetch" href="/assets/js/66.144eca10.js"><link rel="prefetch" href="/assets/js/67.523d8fc4.js"><link rel="prefetch" href="/assets/js/68.e3888dbb.js"><link rel="prefetch" href="/assets/js/69.9bb4d391.js"><link rel="prefetch" href="/assets/js/7.465d1635.js"><link rel="prefetch" href="/assets/js/70.363f057d.js"><link rel="prefetch" href="/assets/js/71.b458f4e3.js"><link rel="prefetch" href="/assets/js/72.61151392.js"><link rel="prefetch" href="/assets/js/73.cf6a509e.js"><link rel="prefetch" href="/assets/js/74.bcf79daa.js"><link rel="prefetch" href="/assets/js/75.6c76dbd9.js"><link rel="prefetch" href="/assets/js/76.8fa20a2d.js"><link rel="prefetch" href="/assets/js/77.1b38be38.js"><link rel="prefetch" href="/assets/js/78.912ab295.js"><link rel="prefetch" href="/assets/js/79.e7dced28.js"><link rel="prefetch" href="/assets/js/8.e18242d7.js"><link rel="prefetch" href="/assets/js/80.a0dff15f.js"><link rel="prefetch" href="/assets/js/81.db56dec0.js"><link rel="prefetch" href="/assets/js/82.8ce4450e.js"><link rel="prefetch" href="/assets/js/83.fc4d85db.js"><link rel="prefetch" href="/assets/js/84.7cb34b0d.js"><link rel="prefetch" href="/assets/js/85.7291027d.js"><link rel="prefetch" href="/assets/js/86.7f8f9892.js"><link rel="prefetch" href="/assets/js/87.03d1d1d8.js"><link rel="prefetch" href="/assets/js/88.ac4d9da3.js"><link rel="prefetch" href="/assets/js/89.11401d6e.js"><link rel="prefetch" href="/assets/js/9.44357992.js"><link rel="prefetch" href="/assets/js/90.febbf57e.js"><link rel="prefetch" href="/assets/js/91.ffedb304.js"><link rel="prefetch" href="/assets/js/92.20b8342a.js"><link rel="prefetch" href="/assets/js/93.77977da0.js"><link rel="prefetch" href="/assets/js/94.ef9094a7.js"><link rel="prefetch" href="/assets/js/95.0136b399.js"><link rel="prefetch" href="/assets/js/96.6bef417b.js"><link rel="prefetch" href="/assets/js/97.30ebc59a.js"><link rel="prefetch" href="/assets/js/98.0a5e3de0.js"><link rel="prefetch" href="/assets/js/99.24f40c7d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ba668900.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">心谭博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notes/" class="nav-link router-link-active">
  技能图谱
</a></div><div class="nav-item"><a href="https://xxoo521.com/frontend/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端图谱
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://xxoo521.com/algorithm/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  算法题解
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/dongyuanxin/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notes/" class="nav-link router-link-active">
  技能图谱
</a></div><div class="nav-item"><a href="https://xxoo521.com/frontend/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端图谱
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://xxoo521.com/algorithm/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  算法题解
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/dongyuanxin/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构和算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/02.设计模式/" class="sidebar-heading clickable"><span>设计模式</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络协议</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>操作系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>架构设计</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>编程语言</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/08.云开发/" class="sidebar-heading clickable"><span>云开发</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node高性能服务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开发工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web前端开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>区块链</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/notes/12.容器化/" class="sidebar-heading clickable"><span>容器化</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/notes/13.ELK/" class="sidebar-link">ELK</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="引言"><a href="#引言" class="header-anchor">#</a> 引言</h2> <p>随着腾讯云云开发能力的日渐完善，有经验的工程师已经可以独立完成一个产品的开发和上线。<strong>但网上云开发相关的实战文章非常少，很多开发者清楚云开发的能力，但是不清楚如何在现有的开发体系下引入云开发</strong>。</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gez0z9axp8j31e10u0b2a.jpg" alt=""></p> <p>本文从云开发团队开发者+能力使用者的角度，以云开发官网 (<a href="http://cloudbase.net/" target="_blank" rel="noopener noreferrer">http://cloudbase.net/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>) 的搭建思路为例，分享云开发结合流行框架与工具的实战经验。</p> <p><strong>涉及到的知识点有</strong>：</p> <ul><li>云开发：
<ul><li>扩展能力（CMS 扩展）</li> <li>静态托管</li> <li>云函数</li> <li>云数据库</li> <li>CloudBase CLI 工具</li></ul></li> <li>React 框架：Next.js</li> <li>CI 自动构建</li></ul> <h2 id="背景介绍"><a href="#背景介绍" class="header-anchor">#</a> 背景介绍</h2> <p>随着云开发团队业务的迅猛发展，团队需要一个官网来更直观、更即时地向开发者们展示云开发的相关能力，包括但不限于工具链、SDK、技术文档等。</p> <p>同时，为了降低开发者的上手成本，积累业界的优秀实战经验，官网也承载着营造社区氛围、聚合重要资料、增强用户黏度的重要任务。</p> <p>我们最初使用 VuePress 作为静态网站工具，遇到了一些痛点：</p> <ul><li><strong>问题 1: 每次更新内容，都需要配合 git。运营同学对 git 不熟悉</strong></li> <li><strong>问题 2: 学习资料方面的内容更新过于频繁，“污染”了 git 记录</strong></li> <li><strong>问题 3: 内容和网站代码耦合</strong></li> <li><strong>问题 4: 缺少可视化的内容编辑工具</strong></li></ul> <p>我们使用「CMS 扩展」、「云开发基础能力」、「Next.js」、「CI 工具」，很好地解决了以上问题。在实现网站内容动态化的同时，保证了 SEO，运营同学也可以通过 CMS 对内容进行可视化管理。</p> <h2 id="安装-cms"><a href="#安装-cms" class="header-anchor">#</a> 安装 CMS</h2> <p>进入<a href="https://console.cloud.tencent.com/tcb/add" target="_blank" rel="noopener noreferrer">云开发扩展能力控制台<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，根据引导，安装 CMS</p> <p>内容管理系统。</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gezbg60ioij31fz0u0ncc.jpg" alt=""></p> <p>在最后进行扩展程序配置的时候，有两种账号：管理员账号和运营者账号。管理员账号权限更高，可以创建新的数据集合；而运营者账号只能在已有的数据集合上进行增删改的操作。</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gezbi2twy0j31gl0u041d.jpg" alt=""></p> <blockquote><p><strong>注意：</strong>
安装时间有些长，请耐心等待</p></blockquote> <p>安装成功后，云数据库会自动创建 3 个集合：<code>tcb-ext-cms-contents</code>、<code>tcb-ext-cms-users</code>、<code>tcb-ext-cms-webhooks</code>。</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gezbngm3y6j31nt0u0q8f.jpg" alt=""></p> <p>会自动创建 3 个云函数：<code>tcb-ext-cms-api</code>、<code>tcb-ext-cms-init</code>、<code>tcb-ext-cms-auth</code>。</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gezbpx8nrhj31lh0u0tes.jpg" alt=""></p> <p>进入「静态网站托管」，可以看到 CMS 系统的静态文件已经自动上传到<code>tcb-cms/</code>目录下了：</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gezbunf926j31mt0u0afk.jpg" alt=""></p> <p>点击上方的「基础配置」，就可以查看到域名信息。</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gezbvpy0fpj31a70u0dnt.jpg" alt=""></p> <p>在浏览器中访问：<a href="http://pagecounter-d27cfe-1255463368.tcloudbaseapp.com/tcb-cms/" target="_blank" rel="noopener noreferrer">http://pagecounter-d27cfe-1255463368.tcloudbaseapp.com/tcb-cms/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 即可看到 CMS 系统：</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gezbxipje4j31oi0tokge.jpg" alt=""></p> <p>到此为止，无任何开发成本，一个 CMS 内容管理系统就正式上线了～</p> <h2 id="使用-cms-创建动态内容"><a href="#使用-cms-创建动态内容" class="header-anchor">#</a> 使用 CMS 创建动态内容</h2> <p>对于动态化的数据内容，我们将其划分为不同的模块。每个内容模块，对应 CMS 系统的一个数据集合。例如「云开发官网」-「社区页」中，推荐好课的内容就是动态的。</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gezc29itjnj31e10u0kjl.jpg" alt=""></p> <p>从图中可以看到，每节课程有着多个属性。而在云数据库中，每节课程就对应一个文档，课程属性就对应文档的字段。字段类型与含义如下：</p> <div class="language-纯文本 line-numbers-mode"><pre class="language-text"><code>name&lt;string&gt;: 课程名称
time&lt;number&gt;: 课程时间
cover&lt;string&gt;: 课程封面
url&lt;string&gt;: 课程链接
level&lt;0 | 1 | 2&gt;: 课程难度
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>以管理员身份登录 CMS 系统，在「内容设置页」新建内容。在 CMS 中，支持多种高级数据类型，例如 url、图片、markdown、富文本、标签数组、邮箱、网址等，并对这些类型进行了智能识别和更友好地展示。</p> <blockquote><p><strong>注意：</strong>
CMS 自带图床功能。当数据类型是「图片」时，图片会自动上传到当前云开发环境下的云存储中。图片信息以 <code>cloud://</code> 开头的特殊链接，存放在数据集合中。</p></blockquote> <p>新建内容时，默认情况下，CMS 会自动填充 4 个字段：name、order、createTime、updateTime。可以根据自身需要，对不需要的字段进行删除。</p> <blockquote><p><strong>建议：</strong>
保留 order 字段，它可以被用作数据排序。对运营者来说，数据的 order 的值越大，在 CMS 系统中展示的位置越靠前；对开发者来说，可以根据 order 来进行排序搜索。从而保证了体验和逻辑的一致性。</p></blockquote> <p>根据字段创建集合后，CMS 系统左侧会看到「推荐好课」。它对应的内容被保存在云数据库的<code>recommend-course</code>（创建时指定）集合中，它的字段信息保存在云数据库的<code>tcb-ext-cms-contents</code>（CMS 初始化时创建）集合中。</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gezcvlw9b4j312b0u0gu1.jpg" alt=""></p> <p>按照设定添加新的课程内容后，再次进入「推荐好课」，如下所示：</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gezcwwgnb0j322c0tk44l.jpg" alt=""></p> <p>图片、链接等内容，更友好地展示给运营者。</p> <h2 id="项目搭建"><a href="#项目搭建" class="header-anchor">#</a> 项目搭建</h2> <p>按照 <a href="https://nextjs.frontendx.cn/" target="_blank" rel="noopener noreferrer">Next.js 文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的指引，创建 Next.js 项目：</p> <div class="language-纯文本 line-numbers-mode"><pre class="language-text"><code>npm i --save next react react-dom axios
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>因为我们要将网站部署到「静态托管」上，所以要使用 Next.js 的<strong>静态导出</strong>功能。<code>package.json</code> 中的打包脚本更新为：</p> <div class="language-JSON line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next build &amp;&amp; next export&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;next start&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>为了快速部署静态网站，以及发布云函数。需要全局安装 <code>@cloudbase/cli</code>:</p> <div class="language-纯文本 line-numbers-mode"><pre class="language-text"><code>npm install -g @cloudbase/cli
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装后，添加两个脚本：</p> <ul><li><code>deploy:hosting</code>: 将 Next.js 的静态导出文件部署到「静态托管」</li> <li><code>deploy:function</code>: 发布项目中的云函数</li></ul> <div class="language-JSON line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;deploy:hosting&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run build &amp;&amp; cloudbase hosting:deploy out -e jhgjj-0ae4a1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;deploy:function&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo y | cloudbase functions:deploy --force&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p><strong>注意：</strong>
准备两个云环境，防止静态部署时文件覆盖。envId 为 <code>jhgjj-0ae4a1</code> 的云环境只用于部署 Next.js 的静态导出文件。envId 为 <code>pagecounter-d27cfe</code> 的云环境用来部署 CMS 系统。</p></blockquote> <h2 id="获取-cms-内容"><a href="#获取-cms-内容" class="header-anchor">#</a> 获取 CMS 内容</h2> <h3 id="编写云函数"><a href="#编写云函数" class="header-anchor">#</a> 编写云函数</h3> <p>为了能在 Next.js 中读取到 CMS 系统的最新数据，我们需要新建一个云函数，配合 HTTP Service，解析 Next.js 传入的参数，读取云数据库中的信息，并且返回给 Next.js。</p> <blockquote><p><strong>为什么需要云函数配合 HTTP Service，不能直接使用 SDK 吗？</strong>
Next.js 预渲染的环境不支持 SDK（tcb-admin-node、tcb-js-sdk）。在 Next.js 中，动态获取数据注入到模板变量时，需要在 <code>getInitialProps()</code> 方法中进行异步操作。<strong>我们使用 axios（支持 ssr 环境），通过访问 url（云开发 HTTP Service 能力）触发云函数，获取最新数据</strong>。</p></blockquote> <p>在项目目录下创建<code>config.js</code>，存放一些配置信息：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    envId<span class="token operator">:</span> <span class="token string">&quot;pagecounter-d27cfe&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 云开发环境envid</span>
    siteAuthKey<span class="token operator">:</span> <span class="token string">&quot;QhBYWnRjijGcGTBUxDFGWxuq&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 用于site-cms-data云函数中的身份校验</span>
    httpPath<span class="token operator">:</span> <span class="token string">&quot;/site-cms-data&quot;</span> <span class="token comment">// site-cms-data云函数的http触发路径</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>创建 CloudBase CLI 工具的配置文件<code>cloudbase.js</code>，用于云函数部署:</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> envId<span class="token punctuation">,</span> siteAuthKey <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./config&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    envId<span class="token punctuation">,</span>
    functionRoot<span class="token operator">:</span> <span class="token string">&quot;./cloudfunctions&quot;</span><span class="token punctuation">,</span>
    functions<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">&quot;site-cms-data&quot;</span><span class="token punctuation">,</span>
            config<span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">// 超时时间</span>
                timeout<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
                <span class="token comment">// 环境变量</span>
                envVariables<span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token constant">SITE_AUTH_KEY</span><span class="token operator">:</span> siteAuthKey
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                runtime<span class="token operator">:</span> <span class="token string">&quot;Nodejs8.9&quot;</span><span class="token punctuation">,</span>
                installDependency<span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            handler<span class="token operator">:</span> <span class="token string">&quot;index.main&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>创建 <code>cloudfunctions/site-cms-data/</code> 目录，里面存放云函数的主要逻辑。</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gezw041pcrj30k807i0tf.jpg" alt=""></p> <p><code>provider.js</code>中提供 Provider 对象，它支持：</p> <ul><li><code>fetchAll()</code>：获取指定集合的所有数据</li> <li><code>query()</code>：支持<code>orderBy</code>、<code>where</code>的条件查询</li></ul> <p>之后我们会在 Next.js 端传入名为<code>api</code>的参数，它必须是 Provider 支持的方法。<code>dispatch()</code>会根据前端传入的<code>api</code>，自动调用 Provider 上的方法。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> Provider <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取指定集合的所有数据</span>
    <span class="token keyword">async</span> <span class="token function">fetchAll</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>
            db<span class="token punctuation">,</span>
            params<span class="token operator">:</span> <span class="token punctuation">{</span> collectionName <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">;</span>
        <span class="token keyword">const</span> collection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span>collectionName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> collection
            <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                _id<span class="token operator">:</span> <span class="token regex">/.*/</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 支持orderBy、where的条件查询（满足当前需求）</span>
    <span class="token keyword">async</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>
            db<span class="token punctuation">,</span>
            params<span class="token operator">:</span> <span class="token punctuation">{</span> collectionName<span class="token punctuation">,</span> orderBy<span class="token punctuation">,</span> where <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">;</span>
        <span class="token keyword">let</span> promise <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span>collectionName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>orderBy<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> orderBy<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            promise <span class="token operator">=</span> promise<span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token operator">...</span>orderBy<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> where <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            promise <span class="token operator">=</span> promise<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>where<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> promise<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> Provider<span class="token punctuation">[</span>ctx<span class="token punctuation">.</span>api<span class="token punctuation">]</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    Provider<span class="token punctuation">,</span>
    dispatch
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p><code>interceptor.js</code>提供：</p> <ul><li><code>vertifyAuth()</code>: 用户身份检验</li> <li><code>isValidBody()</code>: 参数类型检验</li></ul> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./provider&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> supportedApi <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">ownKeys</span><span class="token punctuation">(</span>Provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">vertifyAuth</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 前面在cloudbase.js中规定的环境变量</span>
    <span class="token keyword">return</span> ctx<span class="token punctuation">.</span>key <span class="token operator">===</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SITE_AUTH_KEY</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">isValidBody</span><span class="token punctuation">(</span><span class="token parameter">body</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token string">&quot;key&quot;</span> <span class="token keyword">in</span> body <span class="token operator">&amp;&amp;</span> <span class="token comment">// 验证身份的随机密钥</span>
        <span class="token string">&quot;params&quot;</span> <span class="token keyword">in</span> body <span class="token operator">&amp;&amp;</span> <span class="token comment">// 携带调用服务需要的参数</span>
        <span class="token string">&quot;api&quot;</span> <span class="token keyword">in</span> body <span class="token operator">&amp;&amp;</span> <span class="token comment">// 调用服务名称</span>
        supportedApi<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span>api<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    vertifyAuth<span class="token punctuation">,</span>
    isValidBody
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>在 <code>index.js</code> 中，封装了云函数的整体逻辑：</p> <ol><li>检验 Next.js 端传入数据是否合法</li> <li>检验身份密钥，防止云数据库被盗刷</li> <li>绑定特殊变量到上下文，减少 tcb 对象的实例化次数</li> <li>调用对应服务，返回结果</li></ol> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> tcb <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;tcb-admin-node&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> vertifyAuth<span class="token punctuation">,</span> isValidBody <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./interceptor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> dispatch <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./provider&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> ctx <span class="token operator">=</span> <span class="token punctuation">{</span>
        envId<span class="token operator">:</span> context<span class="token punctuation">.</span>namespace
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 验证传入的数据</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isValidBody</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ctx <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token operator">...</span>ctx<span class="token punctuation">,</span>
                <span class="token operator">...</span>body
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                msg<span class="token operator">:</span> <span class="token string">&quot;传入数据不合法&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            msg<span class="token operator">:</span> <span class="token string">&quot;请检查body格式&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 验证身份</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">vertifyAuth</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            msg<span class="token operator">:</span> <span class="token string">&quot;身份验证失败&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 给上下文绑定db</span>
    <span class="token keyword">const</span> app <span class="token operator">=</span> tcb<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        env<span class="token operator">:</span> ctx<span class="token punctuation">.</span>envId
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>db <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        env<span class="token operator">:</span> ctx<span class="token punctuation">.</span>envId
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 服务调用</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            result
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            msg<span class="token operator">:</span> error<span class="token punctuation">.</span>message
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><blockquote><p><strong>建议：</strong>
在实际开发过程中，请规范云函数的结果返回格式。以此云函数为例，成功时返回: <code>{success: true, result: 结果}</code>，失败时返回: <code>{success: false, msg: 错误信息}</code></p></blockquote> <h3 id="发布云函数"><a href="#发布云函数" class="header-anchor">#</a> 发布云函数</h3> <p>通过 CloudBase CLI 工具的命令，清空之前的登录状态，重新进行登录：</p> <div class="language-纯文本 line-numbers-mode"><pre class="language-text"><code>cloudbase logout &amp;&amp; cloudbase login
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在项目目录下，执行发布云函数的命令：</p> <div class="language-纯文本 line-numbers-mode"><pre class="language-text"><code>npm run deploy:function
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在「云开发控制台」-「云函数页」中，可以看到云函数<code>site-cms-data</code>上传成功：</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gezzkmla7ej327g0u0wlx.jpg" alt=""></p> <p>进入云函数<code>site-cms-data</code>，在「函数配置」中，修改“HTTP 触发路径”（和 <code>config.js</code> 中的 <code>httpPath</code> 字段保持一致）：</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gezznghm7lj30xt0u0n3o.jpg" alt=""></p> <p>成功后，我们可以就可以通过 <code>https://${envId}.service.tcloudbase.com/site-cms-data</code> 来触发此函数。</p> <h3 id="在-next-js-中获取动态数据"><a href="#在-next-js-中获取动态数据" class="header-anchor">#</a> 在 Next.js 中获取动态数据</h3> <p>在云函数 <code>site-cms-data</code> 中，只解析外界传入的 3 个参数：</p> <table><thead><tr><th>参数名</th> <th>参数类型</th> <th>参数含义</th></tr></thead> <tbody><tr><td>key</td> <td><code>string</code></td> <td>校验密钥，可以从<code>config.js</code>中读取</td></tr> <tr><td>api</td> <td><code>string</code></td> <td>云函数<code>Provider</code>支持的方法</td></tr> <tr><td>params</td> <td><code>object</code></td> <td>上述方法的入参</td></tr></tbody></table> <p>为了避免每次都重复编写 axios 的请求配置，将一些共用的信息抽离出来, <code>generateAxiosConfig()</code> 实现如下:</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// provider.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> siteAuthKey <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./config&quot;</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * 为axios生成请求配置
 * @param {String} api 云函数(site-cms-data)支持的服务
 * @param {Object} params 服务入参
 */</span>
<span class="token keyword">function</span> <span class="token function">generateAxiosConfig</span><span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
        key<span class="token operator">:</span> siteAuthKey<span class="token punctuation">,</span>
        api<span class="token punctuation">,</span>
        params
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
        headers<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/json&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        method<span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>前文有讲到，CMS 自带图床功能，拖拽上传的图片会被存储在同一环境下的云存储中，并且获取图片的链接存放在集合中。<strong>云存储的链接是以 **</strong><code>cloud://</code>*<strong>* 开头的特殊链接，需要在前端进行识别和特殊处理</strong>。</p> <p>以前文我们上传的图片为例，它的链接是：<code>cloud://pagecounter-d27cfe.7061-pagecounter-d27cfe-1255463368/uploads/1589990230404.png</code>。将其转成可访问的 http 链接：<code>https://7061-pagecounter-d27cfe-1255463368.tcb.qcloud.la/uploads/1589990230404.png</code>。</p> <p>转换思路是：识别 envid 后的信息，将其与<code>tcb.qcloud.la</code>域名重新拼接即可。代码实现如下：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// provider.js</span>
<span class="token comment">/**
 * 获取云存储的访问链接
 * @param {String} url 云存储的特定url
 */</span>
<span class="token keyword">function</span> <span class="token function">getBucketUrl</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>url<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;cloud://&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> url<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> re <span class="token operator">=</span> <span class="token regex">/cloud:\/\/.*?\.(.*?)\/(.*)/</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.tcb.qcloud.la/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><blockquote><p><strong>注意</strong>：
云存储的「权限设置」应为：所有用户可读，仅创建者及管理员可写。否则链接无法访问。</p></blockquote> <blockquote><p><strong>推荐</strong>：
除了自带的图床功能，开发者可以根据自身需求使用其他稳定图床服务，例如微博图床。如果使用其他图床，对应字段类型不能设置为「图片」，可以是「字符串」或者「超链接」。</p></blockquote> <p>在 <code>provider.js</code> 中对外暴露 <code>getCourses()</code> 方法，获取「推荐课程」的数据，并且进行处理：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> siteAuthKey<span class="token punctuation">,</span> envId<span class="token punctuation">,</span> httpPath <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./config&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>envId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.service.tcloudbase.com</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>httpPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token comment">/**
 * 获取推荐课程数据
 */</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getCourses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">generateAxiosConfig</span><span class="token punctuation">(</span><span class="token string">&quot;fetchAll&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        collectionName<span class="token operator">:</span> <span class="token string">&quot;recommend-course&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> success<span class="token punctuation">,</span> result<span class="token punctuation">,</span> msg <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token operator">...</span>item<span class="token punctuation">,</span>
            cover<span class="token operator">:</span> <span class="token function">getBucketUrl</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>cover<span class="token punctuation">)</span> <span class="token comment">// 处理云存储的特殊链接</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;获取「推荐课程」失败:&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>创建 <code>pages/index.js</code> 文件，它对外暴露的函数组件<code>HomePage</code>(被渲染为首页)。我们在组件上的<code>getInitialProps()</code>方法中获取推荐课程数据，并且将其注入到组件的<code>props</code>上：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getCourses <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./../provider&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">HomePage</span> <span class="token operator">=</span> <span class="token parameter">props</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
HomePage<span class="token punctuation">.</span><span class="token function-variable function">getInitialProps</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">getCourses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>courses<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 返回组件的props</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> courses <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> HomePage<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>在 HomePage 中，可以从 <code>props</code> 中读取到推荐课程数据，将其渲染到页面上即可：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> levelMap <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token number">0</span><span class="token operator">:</span> <span class="token string">&quot;初级&quot;</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token operator">:</span> <span class="token string">&quot;中级&quot;</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token operator">:</span> <span class="token string">&quot;高级&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">HomePage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> courses <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
            <span class="token punctuation">{</span>courses<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">course<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
                <span class="token operator">&lt;</span>div key<span class="token operator">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token punctuation">{</span>course<span class="token punctuation">.</span>url<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token string">&quot;&gt;&gt;&gt; 立即学习&quot;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>strong<span class="token operator">&gt;</span>课程名称：<span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">&gt;</span> <span class="token punctuation">{</span>course<span class="token punctuation">.</span>name<span class="token punctuation">}</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>strong<span class="token operator">&gt;</span>课程时长：<span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">&gt;</span> <span class="token punctuation">{</span>course<span class="token punctuation">.</span>time<span class="token punctuation">}</span> 课时
                    <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>strong<span class="token operator">&gt;</span>课程难度：<span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">&gt;</span>
                        <span class="token punctuation">{</span>levelMap<span class="token punctuation">[</span>course<span class="token punctuation">.</span>level<span class="token punctuation">]</span><span class="token punctuation">}</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>strong<span class="token operator">&gt;</span>课程封面：<span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>course<span class="token punctuation">.</span>cover<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>打开浏览器，进入 <a href="http://localhost:3000/" target="_blank" rel="noopener noreferrer">http://localhost:3000/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>，可以看到效果如下：</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf006o852jj319d0u0guf.jpg" alt=""></p> <p>进入 view-source:<a href="http://localhost:3000/" target="_blank" rel="noopener noreferrer">http://localhost:3000/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ，可以看到网页的 html 源码中包含了课程数据，解决了 SEO 的问题：</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf007i7i7hj32la0goaq2.jpg" alt=""></p> <blockquote><p><strong>注意：</strong> &gt; <code>getInitialProps()</code>方法会将数据序列化，它执行于编译时期，而不是在网页生命周期中触发的。</p></blockquote> <h2 id="自动构建与部署"><a href="#自动构建与部署" class="header-anchor">#</a> 自动构建与部署</h2> <p>目前为止，开发工作基本结束。执行 <code>npm run build</code> 命令，网站静态文件被打包到了 <code>out/</code> 目录下：</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf00fkl5j1j30m80ucdj0.jpg" alt=""></p> <p>执行 <code>npm run deploy:hosting</code> 将 <code>out/</code> 目录下的文件上传到「静态网站托管」。访问静态网站托管的链接：<a href="https://jhgjj-0ae4a1.tcloudbaseapp.com/" target="_blank" rel="noopener noreferrer">https://jhgjj-0ae4a1.tcloudbaseapp.com/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ，效果如下：</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf00jcjxjsj31o90u0wsy.jpg" alt=""></p> <p>借助成熟的 CI 工具，例如 Travis、Circle 等，可以定时触发构建工作。如此一来，内容和开发彻底分离。</p> <p>在构建发布的时候，需要用到 CloudBase CLI 工具。在 CI 工具中，不再使用 <code>cloudbase login</code> 进行交互式输入登录，而是使用密钥登录： <code>cloudbase login --apiKeyId $TCB_SECRET_ID --apiKey $TCB_SECRET_KEY</code> 。</p> <blockquote><p><strong>注意：</strong>
前往 <a href="https://console.cloud.tencent.com/cam/capi" target="_blank" rel="noopener noreferrer">云 API 密钥<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 获得 <code>TCB_SECRET_ID</code> 和 <code>TCB_SECRET_KEY</code> 的值</p></blockquote> <p>在 CI 工具的控制台中，配置 <code>TCB_SECRET_ID</code> 和 <code>TCB_SECRET_KEY</code>。并为<code>package.json</code>新添加一个脚本：</p> <div class="language-JSON line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;login&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo N | cloudbase login --apiKeyId $TCB_SECRET_ID --apiKey $TCB_SECRET_KEY&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>总结来说，CI 构建的流程是：</p> <ul><li>tcb 密钥登录：<code>npm run login</code></li> <li>获取最新数据，导出静态文件：<code>npm run build</code></li> <li>发布到「静态网站托管」：<code>npm run deploy:function</code></li></ul> <p>如果数据需要紧急修改上线，可以在本地或者 CI 工具控制台，手动触发构建。</p> <h2 id="最后"><a href="#最后" class="header-anchor">#</a> 最后</h2> <p>在现有开发体系下，合理运用云开发，使得人力成本、开发成本以及运维成本大幅度降低。前后端一把梭，构成“闭环”。</p> <p>本文实战仅是抛砖引玉，涉及了云开发能力的一部分，还有更多好玩的东西等待你的探索，比如使用云函数实现 SSR、托管后端服务、图像服务、各端 SDK 等。</p> <p><strong>探索能力，发散思路，以更低成本开发高可用的 web 服务，云开发绝对是你最好的选择！</strong></p> <p><strong>更多资料</strong>：</p> <ul><li><a href="https://cloudbase.net/" target="_blank" rel="noopener noreferrer">云开发社区官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.cloudbase.net/extension/abilities/cms.html" target="_blank" rel="noopener noreferrer">CMS 内容管理系统<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dongyuanxin/blog/edit/master/notes/08.云开发/1.实战案例/4.社区官网架构：云开发+NextJs+CMS/readme.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">更新于:</span> <span class="time">9/20/2020, 1:53:34 PM</span></div></footer> <!----> <aside class="right-sidebar"><div class="right-sidebar-links"><div class="right-sidebar-header">关注公众号</div> <img src="https://tva1.sinaimg.cn/large/006tNbRwly1gaknn8mr5ej3076076aaj.jpg" alt="公众号搜索：心谭博客" srcset></div> <div class="right-sidebar-links"><div class="right-sidebar-header">
            本文目录
        </div> <div><ul><li><a href="/notes/08.%E4%BA%91%E5%BC%80%E5%8F%91/1.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E7%A4%BE%E5%8C%BA%E5%AE%98%E7%BD%91%E6%9E%B6%E6%9E%84%EF%BC%9A%E4%BA%91%E5%BC%80%E5%8F%91+NextJs+CMS/#引言">引言</a></li><li><a href="/notes/08.%E4%BA%91%E5%BC%80%E5%8F%91/1.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E7%A4%BE%E5%8C%BA%E5%AE%98%E7%BD%91%E6%9E%B6%E6%9E%84%EF%BC%9A%E4%BA%91%E5%BC%80%E5%8F%91+NextJs+CMS/#背景介绍">背景介绍</a></li><li><a href="/notes/08.%E4%BA%91%E5%BC%80%E5%8F%91/1.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E7%A4%BE%E5%8C%BA%E5%AE%98%E7%BD%91%E6%9E%B6%E6%9E%84%EF%BC%9A%E4%BA%91%E5%BC%80%E5%8F%91+NextJs+CMS/#安装-cms">安装 CMS</a></li><li><a href="/notes/08.%E4%BA%91%E5%BC%80%E5%8F%91/1.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E7%A4%BE%E5%8C%BA%E5%AE%98%E7%BD%91%E6%9E%B6%E6%9E%84%EF%BC%9A%E4%BA%91%E5%BC%80%E5%8F%91+NextJs+CMS/#使用-cms-创建动态内容">使用 CMS 创建动态内容</a></li><li><a href="/notes/08.%E4%BA%91%E5%BC%80%E5%8F%91/1.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E7%A4%BE%E5%8C%BA%E5%AE%98%E7%BD%91%E6%9E%B6%E6%9E%84%EF%BC%9A%E4%BA%91%E5%BC%80%E5%8F%91+NextJs+CMS/#项目搭建">项目搭建</a></li><li><a href="/notes/08.%E4%BA%91%E5%BC%80%E5%8F%91/1.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E7%A4%BE%E5%8C%BA%E5%AE%98%E7%BD%91%E6%9E%B6%E6%9E%84%EF%BC%9A%E4%BA%91%E5%BC%80%E5%8F%91+NextJs+CMS/#获取-cms-内容">获取 CMS 内容</a><ul><li><a href="/notes/08.%E4%BA%91%E5%BC%80%E5%8F%91/1.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E7%A4%BE%E5%8C%BA%E5%AE%98%E7%BD%91%E6%9E%B6%E6%9E%84%EF%BC%9A%E4%BA%91%E5%BC%80%E5%8F%91+NextJs+CMS/#编写云函数">编写云函数</a></li><li><a href="/notes/08.%E4%BA%91%E5%BC%80%E5%8F%91/1.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E7%A4%BE%E5%8C%BA%E5%AE%98%E7%BD%91%E6%9E%B6%E6%9E%84%EF%BC%9A%E4%BA%91%E5%BC%80%E5%8F%91+NextJs+CMS/#发布云函数">发布云函数</a></li><li><a href="/notes/08.%E4%BA%91%E5%BC%80%E5%8F%91/1.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E7%A4%BE%E5%8C%BA%E5%AE%98%E7%BD%91%E6%9E%B6%E6%9E%84%EF%BC%9A%E4%BA%91%E5%BC%80%E5%8F%91+NextJs+CMS/#在-next-js-中获取动态数据">在 Next.js 中获取动态数据</a></li></ul></li><li><a href="/notes/08.%E4%BA%91%E5%BC%80%E5%8F%91/1.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E7%A4%BE%E5%8C%BA%E5%AE%98%E7%BD%91%E6%9E%B6%E6%9E%84%EF%BC%9A%E4%BA%91%E5%BC%80%E5%8F%91+NextJs+CMS/#自动构建与部署">自动构建与部署</a></li><li><a href="/notes/08.%E4%BA%91%E5%BC%80%E5%8F%91/1.%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/4.%E7%A4%BE%E5%8C%BA%E5%AE%98%E7%BD%91%E6%9E%B6%E6%9E%84%EF%BC%9A%E4%BA%91%E5%BC%80%E5%8F%91+NextJs+CMS/#最后">最后</a></li></ul></div></div> <div class="right-sidebar-links"><div class="right-sidebar-header">
            最近更新
            <a href="/guide/" target="_blank">&gt;&gt;&gt;查看全部</a></div> <div class="right-sidebar-item"><a target="_blank" href="/notes/09.Node%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1/02.KoaJS/02.KoaJS%EF%BC%9A%E6%B4%8B%E8%91%B1%E6%A8%A1%E5%9E%8B/" title="is-generator-function：判断 generator">is-generator-function：判断 generator</a></div><div class="right-sidebar-item"><a target="_blank" href="/notes/07.%E6%95%B0%E6%8D%AE%E5%BA%93/1.%E6%95%B0%E6%8D%AE%E9%9A%94%E7%A6%BB/1.%E9%94%81%E6%9C%BA%E5%88%B6/" title="乐观锁">乐观锁</a></div><div class="right-sidebar-item"><a target="_blank" href="/notes/07.%E6%95%B0%E6%8D%AE%E5%BA%93/1.%E6%95%B0%E6%8D%AE%E9%9A%94%E7%A6%BB/2.%E8%AF%BB%E5%86%99%E5%BC%82%E5%B8%B8/" title="场景">场景</a></div><div class="right-sidebar-item"><a target="_blank" href="/notes/07.%E6%95%B0%E6%8D%AE%E5%BA%93/1.%E6%95%B0%E6%8D%AE%E9%9A%94%E7%A6%BB/3.%E9%9A%94%E7%A6%BB%E6%9C%BA%E5%88%B6/" title="快照隔离">快照隔离</a></div><div class="right-sidebar-item"><a target="_blank" href="/notes/09.Node%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1/16.%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81/04.SSO/" title="SSO: Signgle Sign On">SSO: Signgle Sign On</a></div><div class="right-sidebar-item"><a target="_blank" href="/notes/09.Node%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1/16.%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81/03.Token/01.JWT/" title="JSON Web Token">JSON Web Token</a></div><div class="right-sidebar-item"><a target="_blank" href="/notes/09.Node%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1/16.%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81/03.Token/" title="为什么需要 Token？">为什么需要 Token？</a></div><div class="right-sidebar-item"><a target="_blank" href="/notes/09.Node%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1/15.%E6%9C%8D%E5%8A%A1%E6%80%A7%E8%83%BD/02.%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/" title="场景">场景</a></div></div></aside> </main></div><div class="global-ui"><div class="my-loader center" style="display:none;" data-v-354e1a9e><div class="my-loader-circle" data-v-354e1a9e></div></div><div class="my-popup" style="display:none;" data-v-3414bdeb><div class="my-popup-container" data-v-3414bdeb><div class="my-popup-exit" data-v-3414bdeb></div> <img src="" alt data-v-3414bdeb></div></div><!----><!----><div></div></div></div>
    <script src="/assets/js/app.f478fbae.js" defer></script><script src="/assets/js/2.698e7189.js" defer></script><script src="/assets/js/3.9966209a.js" defer></script><script src="/assets/js/235.5560e5d3.js" defer></script><script src="/assets/js/5.51d45416.js" defer></script>
  </body>
</html>
